<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Australian Animals</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playwrite+AU+NSW:wght@100..400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
    
    <style>
      /* Ensure the map takes up full width and defined height */
      #map {
        height: 500px;  /* Adjust the height to your needs */
        width: 100%;
      }
    </style>
  </head>
  <body>
    <main>
        <h1 class="playwrite-au-nsw-bold">Australian Animals</h1>  
    </main>

    <!-- The map container -->
    <div id="map"></div>
    
    <script>
      // Initialize the Leaflet map, center it in Australia
      const map = L.map('map').setView([-25.3444, 131.0369], 4); // Centered in Australia
    
      // Add OpenStreetMap tiles
      const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);

      var koppenLayer = L.tileLayer.wms('https://services.arcgis.com/P3ePLMYs2RVChkJx/ArcGIS/rest/services/Koppen_Geiger_Climate_Classification/MapServer/WMSServer', {
      layers: '0',  // First and only layer
      format: 'image/png',
      transparent: true,
      attribution: 'K√∂ppen-Geiger Climate Classification ¬© ESRI, ArcGIS Online'
    }).addTo(map);
      
  
      // GeoJSON wildlife sightings data
      const geojsonWildlife = {
        "type": "FeatureCollection",
        "features": [
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [144.9631, -37.8136]
            },
            "properties": {
              "species": "Koala",
              "date": "2024-08-15",
              "location": "You Yangs Regional Park near Melbourne, Australia",
              "description": "Spotted near a eucalyptus tree in the park.",
              "iconUrl": "Icons/koala.png" 
            }
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [153.0281, -27.4678]
            },
            "properties": {
              "species": "Flying Fox",
              "date": "2023-07-22",
              "location": "Brisbane, Australia",
              "description": "Observed during evening feeding time.",
              "iconUrl": "Icons/bat.png" 
            }
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [138.6007, -34.9285]
            },
            "properties": {
              "species": "Kangaroo",
              "date": "2023-09-01",
              "location": "Adelaide, Australia",
              "description": "Seen hopping across a field near the outskirts of the city.",
              "iconUrl": "Icons/kangaroo.png" 
            }
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [151.2093, -33.8688]
            },
            "properties": {
              "species": "Platypus",
              "date": "2022-06-15",
              "location": "Sydney, Australia",
              "description": "Spotted near a freshwater creek.",
              "iconUrl": "Icons/platy.png" 
            }
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [122.2558, -17.9614]
            },
            "properties": {
              "species": "Saltwater Crocodile",
              "date": "2023-05-12",
              "location": "Broome, Western Australia",
              "description": "Seen swimming near the mangroves.",
              "iconUrl": "Icons/croco.png" 
            }
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [130.8456, -12.4634]
            },
            "properties": {
              "species": "Frill-necked Lizard",
              "date": "2023-10-05",
              "location": "Darwin, Australia",
              "description": "Observed displaying its frill in a defensive posture.",
              "iconUrl": "Icons/liz.png" 
            }
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [146.7753, -19.2576]
            },
            "properties": {
              "species": "Cassowary",
              "date": "2023-08-22",
              "location": "Townsville, Australia",
              "description": "Spotted in a dense forest area.",
              "iconUrl": "Icons/casso.png" 
            }
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [117.8757, -23.6980]
            },
            "properties": {
              "species": "Dingo",
              "date": "2021-09-14",
              "location": "Karijini National Park, Western Australia",
              "description": "Heard howling at night, spotted the next morning near the campsite.",
              "iconUrl": "Icons/dingo.png" 
            }
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [142.7028, -10.5844]
            },
            "properties": {
              "species": "Green Sea Turtle",
              "date": "2023-11-01",
              "location": "Cape York Peninsula, Australia",
              "description": "Observed nesting on the beach.",
              "iconUrl": "Icons/turtle.png" 
            }
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [137.0655, -25.3444]
            },
            "properties": {
              "species": "Wedge-tailed Eagle",
              "date": "2024-07-30",
              "location": "Outback, Australia",
              "description": "Seen soaring above the desert plains.",
              "iconUrl": "Icons/eagle.png" 
            }
          }
        ]
      };

      

 
  // Function to use custom icons from GeoJSON properties
  function pointToLayer(feature, latlng) {
      if (feature.properties.iconUrl) {
          let customIcon = L.icon({
              iconUrl: feature.properties.iconUrl || 'Icons/default.png',  // Use default icon if none provided
              iconSize: [35, 32],  // Icon size
              iconAnchor: [16, 32],  // Anchor point of the icon
              popupAnchor: [0, -32]  // Where the popup should open
          });

          return L.marker(latlng, { icon: customIcon });  // Return marker with custom icon
      } else {
          // Return a default marker for other species
          return L.marker(latlng);
      }
  }

  // Add the GeoJSON data to the map with custom icons and popups
  L.geoJSON(geojsonWildlife, {
      pointToLayer: pointToLayer,
      onEachFeature: function (feature, layer) {
          layer.bindPopup(
              "<b>Species:</b> " + feature.properties.species +
              "<br><b>Date:</b> " + feature.properties.date +
              "<br><b>Location:</b> " + feature.properties.location +
              "<br><b>Description:</b> " + feature.properties.description
          );
      }
  }).addTo(map);
  
  // Functionality for clicking on the map
  map.on('click', async function (e) {
      const lat = e.latlng.lat;
      const lon = e.latlng.lng;

      // Fetch place name for the clicked location
      const placeName = await getPlaceName(lat, lon);

      // Display the place name in a popup
      L.popup()
          .setLatLng(e.latlng)
          .setContent(`<b>Location:</b> ${placeName}<br>Latitude: ${lat.toFixed(4)}<br>Longitude: ${lon.toFixed(4)}`)
          .openOn(map);
  });

  // Function to get the place name based on latitude and longitude
  async function getPlaceName(lat, lng) {
      const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`);
      const data = await response.json();
      
      if (data.address) {
          const addressComponents = [
              data.address.town,
              data.address.city,
              data.address.village,
              data.address.district,
              data.address.county,
              data.address.state,
              data.address.country
          ].filter(component => component);  // Filter out undefined/null values

          // Get the last two components
          const lastTwoComponents = addressComponents.slice(-2);
          return lastTwoComponents.join(', ');
      }
      
      return 'Unknown Location';
  }

  // Initial welcome popup
  const welcomePopup = L.popup({ offset: L.point(20, 30) })
      .setLatLng([-25.3444, 137.0655])
      .setContent("<b>Welcome to Animals in Australia Map ü¶ò üê® </b><br />Click on the markers to learn more about each animal.")
      .openOn(map);
    </script>
    
    <script src="index.js"></script>
  </body>
</html>
